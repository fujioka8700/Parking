# 立体駐車場故障対応検索システム 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名

立体駐車場故障対応検索システム（Parking Fault Search System）

### 1.2 バージョン

1.0.0

### 1.3 作成日

2025 年 12 月 27 日

### 1.4 最終更新日

2025 年 12 月 28 日

---

## 2. 目的・背景

### 2.1 背景

立体駐車場の故障対応業務において、操作画面に表示される故障コードと故障内容を基に、適切な対応方法を迅速に確認し、修理対応を行う必要がある。現在は、エクセルファイル「TP_manual.xls」に記載された故障コード一覧、故障内容、対応方法を手動で確認している。

また、センサ状態を確認する際も、エクセルファイル内の「センサ状態対応表」を参照する必要がある。

### 2.2 目的

- 故障コードから対応方法を迅速に検索できるようにする
- センサ状態の確認を簡単に行えるようにする
- 現場での作業効率を向上させる

### 2.3 対象ユーザー

- 立体駐車場の故障対応を行う技術者

---

## 3. 現状の課題

### 3.1 業務上の課題

1. **検索の非効率性**: エクセルファイルから故障コードを手動で検索する必要がある
2. **情報の分散**: 故障コード、故障内容、対応方法が一箇所にまとまっていない
3. **現場でのアクセス性**: エクセルファイルを常に持ち歩く必要がある
4. **センサ状態の確認**: センサ状態対応表を手動で確認する必要がある

### 3.2 技術的な課題

1. エクセルファイルの構造が複雑（4 シート、ヘッダー行が 3 行目）
2. M コード（M32, M33 など）と表示コード（1, 2, 3 など）の 2 種類のコード体系
3. 欠番の処理が必要（120 個中 51 個が欠番）

---

## 4. 解決策

### 4.1 システムの概要

Web アプリケーションとして、以下の機能を提供する：

- 故障コードの高速検索機能
- センサ状態の確認機能
- モバイル対応による現場での利用

### 4.2 期待される効果

- 故障コード検索時間の短縮（手動検索から数秒での検索）
- センサ状態の即座の確認
- 現場での即座の情報アクセス

---

## 5. 機能要件

### 5.1 故障コード検索機能

#### 5.1.1 検索方法

- **M コード検索**: M32, M33 などの M コードで検索
- **表示コード検索**: 1, 2, 3 などの表示コードで検索
- **故障名称検索**: 故障名称の全文検索
- **故障内容検索**: 故障内容の全文検索
- **複合検索**: 上記の組み合わせ検索

#### 5.1.2 検索結果表示

- 故障コード（M コード、表示コード）
- 故障名称
- 故障内容（詳細表示）
- 対応方法・チェック項目（詳細表示）

#### 5.1.3 詳細表示

- 全情報の表示
- 見やすいレイアウト

### 5.2 センサ状態確認機能

#### 5.2.1 センサ状態一覧表示

- センサ状態対応表の内容を表示
- センサ名とその説明を一覧表示
- 検索機能（センサ名での検索）

#### 5.2.2 センサ状態詳細表示

- 各センサの詳細情報を表示
- 関連する故障コードとの関連性を表示（該当する場合）

### 5.3 モバイル対応

#### 5.3.1 レスポンシブデザイン

- スマートフォン、タブレット、PC に対応
- タッチ操作に最適化

#### 5.3.2 現場での利用

- 故障コードを入力して即座に対応方法を確認
- センサ状態を現場で確認

---

## 6. 非機能要件

### 6.1 パフォーマンス

- 検索結果の表示: 1 秒以内
- ページ読み込み時間: 3 秒以内
- 同時アクセス: 10 ユーザーまで対応

### 6.2 可用性

- システム稼働率: 99%以上

### 6.3 セキュリティ

- データの暗号化（通信時）
- SQL インジェクション対策
- XSS 対策
- CSRF 対策

### 6.4 保守性

- コードの可読性
- ドキュメントの整備
- ログの記録

---

## 7. データ構造

### 7.1 データベース設計

#### 7.1.1 故障マスタ（FaultMaster）

| フィールド名 | 型       | 制約             | 説明                             |
| ------------ | -------- | ---------------- | -------------------------------- |
| id           | Int      | PK, Auto         | 主キー                           |
| faultCode    | String   | UNIQUE, NOT NULL | M コード（M32, M33 など）        |
| displayCode  | String   | NULL             | 表示コード（1, 2, 3 など）       |
| faultName    | String   | NOT NULL         | 故障名称                         |
| faultContent | String   | NULL             | 故障内容（詳細）                 |
| solution     | String   | NULL             | 対応方法・チェック項目           |
| isActive     | Boolean  | DEFAULT true     | 有効フラグ（欠番の場合は false） |
| createdAt    | DateTime | NOT NULL         | 作成日時                         |
| updatedAt    | DateTime | NOT NULL         | 更新日時                         |

**インデックス**:

- faultCode
- displayCode
- faultName

#### 7.1.2 センサ状態マスタ（SensorStatus）

| フィールド名 | 型       | 制約     | 説明                      |
| ------------ | -------- | -------- | ------------------------- |
| id           | Int      | PK, Auto | 主キー                    |
| sensorCode   | String   | UNIQUE   | センサコード（X000 など） |
| sensorName   | String   | NOT NULL | センサ名称                |
| description  | String   | NULL     | センサの説明              |
| createdAt    | DateTime | NOT NULL | 作成日時                  |
| updatedAt    | DateTime | NOT NULL | 更新日時                  |

**インデックス**:

- sensorCode
- sensorName

### 7.2 データソース

データはエクセルファイル「TP_manual.xls」から取得する：

- **異常コードシート**: 故障コード一覧（A 列: M コード、B 列: 表示コード、C 列: 名称、D 列: 内容、E 列: チェック項目）
- **センサ状態対応表シート**: センサ状態一覧

### 7.3 データ量の見積もり

- 故障マスタ: 120 件（有効: 49 件、欠番: 71 件）
- センサ状態マスタ: 96 件

### 7.4 データ初期化プロセス

#### 開発環境
1. エクセルファイル（`data/TP_manual.xls`）を解析
2. JSONファイル（`data/parsed_data.json`）を生成
3. SQLiteデータベース（`data/database.db`）に保存

#### 本番環境
1. 事前に生成されたJSONファイル（`data/parsed_data.json`）を読み込み
2. SQLiteデータベース（`data/database.db`）に保存

**注意**: 本番環境では `xlsx` ライブラリは不要（JSONファイルのみ使用）

---

## 8. 画面構成

### 8.1 トップページ（検索ページ）

- **URL**: `/`
- **機能**:
  - 検索バー（M コード・表示コード・故障名称で検索）
  - 検索結果一覧
    - 故障コード（M コード、表示コード）
    - 故障名称
    - 故障内容（要約）
    - 対応方法（要約）
  - 詳細表示モーダル
    - 全情報の表示

### 8.2 センサ状態ページ

- **URL**: `/sensors`
- **機能**:
  - センサ状態一覧表示
  - 検索機能（センサ名での検索）
  - 詳細表示

---

## 9. 技術スタック

### 9.1 フロントエンド

- **フレームワーク**: Next.js 16
- **言語**: TypeScript
- **UI ライブラリ**: React 19
- **スタイリング**: Tailwind CSS 4
- **状態管理**: React Server Components（Next.js App Router）

### 9.2 バックエンド

- **フレームワーク**: Next.js API Routes
- **言語**: TypeScript
- **ORM**: Prisma 6
- **データベース**: SQLite

### 9.3 インフラストラクチャ

- **コンテナ**: Docker Compose
- **アプリケーションコンテナ**: Node.js 24
- **データベース**: SQLite（ファイルベース、別コンテナ不要）

### 9.4 開発ツール

- **パッケージマネージャー**: npm
- **リンター**: ESLint
- **エクセル解析**: xlsx 0.18.5（データ初期化用）

---

## 10. 開発スケジュール

### 10.1 フェーズ 1: 基盤構築（優先度: 高）

1. データベーススキーマの作成
2. Prisma マイグレーション
3. 基本的な UI コンポーネントの作成
4. データ初期化スクリプトの実装
   - 開発環境: エクセルファイル → JSONファイル生成 → データベース保存
   - 本番環境: JSONファイル → データベース保存

### 10.2 フェーズ 2: 故障コード検索機能（優先度: 高）

1. 故障コード検索機能の実装
2. 検索結果表示機能の実装
3. 詳細表示モーダルの実装

### 10.3 フェーズ 3: センサ状態確認機能（優先度: 高）

1. センサ状態一覧表示機能の実装
2. センサ状態検索機能の実装
3. 詳細表示機能の実装

### 10.4 フェーズ 4: モバイル対応（優先度: 中）

1. レスポンシブデザインの実装
2. タッチ操作の最適化

---

## 11. 制約事項

### 11.1 技術的制約

- エクセルファイルの形式が固定（「TP_manual.xls」形式）
- データベースは SQLite を使用（ファイルベース）
- 開発環境ではエクセルファイルからJSONファイルを生成し、本番環境ではJSONファイルからデータベースに読み込む
- Docker 環境での動作を前提とする

### 11.2 業務的制約

- 故障コードは M コードと表示コードの 2 種類がある
- 欠番の処理が必要（120 個中 51 個が欠番）
- 一部の故障コードには「内容」や「チェック項目」が空の場合がある

### 11.3 セキュリティ制約

- 現時点ではユーザー認証機能は含まない
- データの機密性を考慮した設計が必要

---

## 12. 将来の拡張機能（検討事項）

### 12.1 ユーザー認証機能

- ログイン・ログアウト機能
- ユーザー管理機能

### 12.2 複数駐車場対応

- 駐車場マスタの追加
- 駐車場ごとの故障コード管理

### 12.3 API 化

- RESTful API の提供
- 外部システムとの連携

---

## 13. 参考資料

- [エクセルファイル解析レポート](./EXCEL_ANALYSIS_REPORT.md)
- [README.md](../README.md)

---

## 14. 承認

| 役割                     | 名前 | 承認日 | 署名 |
| ------------------------ | ---- | ------ | ---- |
| プロジェクトマネージャー |      |        |      |
| 開発責任者               |      |        |      |
| 品質保証責任者           |      |        |      |

---

**文書管理情報**

- 作成者: システム開発チーム
- 承認者: （未承認）
- 配布先: プロジェクト関係者全員
